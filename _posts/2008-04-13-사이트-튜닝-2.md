---
layout: post
title: 사이트 튜닝 2
date: 2008-04-13T14:29:08+00:00
categories: 전산기술자
redirect_from:
  - /779
---

이전의 <a href="http://jinto.pe.kr/764" target="_blank">사이트 튜닝 작업</a>을 계속하고 있다. 일단 어제까지의 작업으로 지금 할 수 있는 거의 모든 튜닝은 끝났다.

어제 한 작업은, 두대의 DB 서버중에 과도하게 느린 쪽에 CPU 와 메모리를 하나 추가해주고, 방화벽도 요청하고, 그리고, mysql을 최신버전인 mysql 5.0.52a 로 버전업하기. 이전에 사용중이던 녀석은 무려 3.23 ! 한꺼번에 두계단을 뛰어올랐다. 게다가 replication 까지 다시 셋업!

겁먹고 한 일이었지만, 버전업이나 replication 설정이나 그렇게 어려운 일도 아니었다. 복잡해 보이지만, 안되는 건 아니다.

게다가 5.0 에 들어있는 my-huge.cnf 를 참고해서 mysql 의 캐시 설정을 건드려 주었더니... 무려.. 쿼리의 50% 까지도 캐시히트가 되었다. (동일한 쿼리가 장난아니게 많다는 뜻이기도 하겠다.)

![ ](/assets/media/uploads_1_hk10.JPG)

아마, iowait 는 더 줄었겠지?

아래 그림에서 분홍색이 iowait 다. 분홍색이 적게 나와야 좋다. iowait 에 시간을 먹히면 서비스할 시간은 줄어드니까. 지금은 분홍색이나 빨간색은 거의 보이지 않는다.(빨간색은 더 않좋다던데.. softirq 라던가.)

![ ](/assets/media/uploads_1_jk11.JPG)

 

하긴 이미 많이 줄어든 상태라서 이번 업그레이드가 얼마나 효과적인 것인지 파악하긴 힘들다. 월요일 오후 1시쯤의 피크타임에는 차이가 있을지도.

아래 그림은 나 노가다했어요라는 그림이다. 사이트내부의 트래픽이 100Mbps 정도였는데 지금은 30Mbps 대로 떨어졌다, 는 증거이기도 하다. 저건 진짜 노가다였다. 트래픽 일으키는 쿼리를 하나씩 하나씩 찾고 또 찾고... 사실 대량으로 문제를 일으키는 녀석은 페이지 몇개에 불과했지만... 그걸 찾아내기까지 긴 시간이 걸린 싸움이었다.

![ ](/assets/media/uploads_1_hk11.JPG)

아직은 내가 손댄 이후의 값이 다 반영된 것은 아니고, 어쩌면 다음달에는 알고보니 20Mbps 였네, 라고 한번더 기뻐하게 될지도 모른다.

자, 이제 이 사이트는 여름 성수기를 맞이하여도 문제없이 서비스를 제공할 수 있을것인가. 아마도. 지금 보기에는 그럴것 같다. 그럼, 혼자서 박수를 쳐보자. 짝짝짝.

* * *

### 댓글



<!--- cmt:1147 --->
<!--- mail: --->
<!--- parent:0 --->

<small class=comment>hochan : 축하드려요. <small>(2008-04-13 17:51:51)</small></small>


<!--- cmt:1148 --->
<!--- mail: --->
<!--- parent:1147 --->

<small class=comment>박제권 : 호찬님 만나서 뭔가 맛있는거 또 먹어요. ㅎㅎㅎ <small>(2008-04-13 18:30:31)</small></small>

